<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h1>Editar Usu치rio</h1>
            <form id="edit-user-form">
                <div class="form-group">
                    <label for="name">Nome</label>
                    <input type="text" class="form-control" id="name" name="name" value="<%= user.name %>">
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" id="email" name="email" value="<%= user.email.endereco %>">
                </div>
                <div class="form-group">
                    <label for="role">Role</label>
                    <select class="form-control" id="role" name="userType">
                        <option value="user" class="<%= user.role === 'user' ? 'selected' : '' %>">Cliente</option>
                        <option value="stockist"class="<%= user.role === 'stockist' ? 'selected' : '' %>">estoquista</option>
                        <option value="deliveryd"class="<%= user.role === 'deliveryd' ? 'selected' : '' %>">Entregador</option>
                        <option value="admin" class="<%= user.role === 'admin' ? 'selected' : '' %>">Admin</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Salvar</button>
            </form>
            <div id="message" class="mt-3"></div>
        </div>
    </div>
</div>

<script>
    document.getElementById('edit-user-form').addEventListener('submit', async (event) => {
        event.preventDefault();

        const form = event.target;
        const formData = new FormData(form);
        const rawData = Object.fromEntries(formData.entries());
        const data = {
            name: rawData.name,
            email: {
                endereco: rawData.email
            },
            role: rawData.userType
        };
        const userId = '<%= user._id %>';

        const messageDiv = document.getElementById('message');
        messageDiv.textContent = '';

        try {
            const response = await fetch(`http://localhost:3300/privacy/${userId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });


            const result = await response.json();

            console.log('Resposta do servidor:', result)

            if (result.success) {
                messageDiv.textContent = 'Usu치rio atualizado com sucesso!';
                messageDiv.className = 'alert alert-success';
            } else {
                messageDiv.textContent = result.message || 'Erro ao atualizar usu치rio.';
                messageDiv.className = 'alert alert-danger';
            }
        } catch (error) {
            console.error('Erro ao enviar o formul치rio:', error);
            messageDiv.textContent = 'Erro ao conectar com o servidor.';
            messageDiv.className = 'alert alert-danger';
        }
    });
</script>
