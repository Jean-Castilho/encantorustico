<div class="container" style="
    min-width: 600px;
    display: flex;
    justify-content: center;">
    <div class="row">
        <div class="col-md-12" style="min-width: 600px;">
            <h1>Editar Usu치rio</h1>
            <form id="edit-user-form">
                <div class="form-group">
                    <label for="name">Nome</label>
                    <input type="text" class="form-control" id="name" name="name" value="<%= user.name %>">
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" id="email" name="email" value="<%= user.email.endereco %>">
                </div>
                <div class="form-group">
                    <label for="role">Role</label>
                    <select class="form-control" id="role" name="role">
                        <option value="user" <%= user.role === 'user' ? 'selected' : '' %>>Cliente</option>
                        <option value="stockist" <%= user.role === 'stockist' ? 'selected' : '' %>>Estoquista</option>
                        <option value="delivery" <%= user.role === 'delivery' ? 'selected' : '' %>>Entregador</option>
                        <option value="admin" <%= user.role === 'admin' ? 'selected' : '' %>>Admin</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" id="updatedButton" >Salvar</button>
            </form>
            <div id="message" class="mt-3"></div>
        </div>
    </div>
</div>

<script>
    document.getElementById('edit-user-form').addEventListener('submit', async function(event) {
        event.preventDefault();

        const button = document.getElementById("updatedButton");
        const originalButtonText = button.textContent;
        const messageDiv = document.getElementById('message');

        const notification = document.getElementById('notification-home') || (()=>{
            const newDiv = document.createElement('div');
            newDiv.id = 'notification-home';
            document.body.prepend(newDiv);
            return newDiv;
        })();

        function showNotification(message, isSuccess) {
            messageDiv.textContent = message;
            messageDiv.className = isSuccess ? 'alert alert-success' : 'alert alert-danger';
        }

        button.textContent = "Salvando...";
        button.disabled = true;

        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());
        const userId = '<%= user._id %>';
        const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

        try {
            const response = await fetch(`/admin/user/edit/${userId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': csrfToken,
                },
                body: JSON.stringify(data),
            });

            const result = await response.json();

            if (response.ok && result.success) {
                showNotification('Usu치rio atualizado com sucesso!', true);
            } else {
                showNotification(result.message || 'Erro ao atualizar usu치rio.', false);
            }
        } catch (error) {
            console.error('Erro ao enviar o formul치rio:', error);
            showNotification('Erro ao conectar com o servidor.', false);
        } finally {
            button.textContent = originalButtonText;
            button.disabled = false;
        }
    });
</script>