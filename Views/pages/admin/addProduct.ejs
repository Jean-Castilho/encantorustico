<div class="add-product-form">
    <div class="card">
        <div class="page-header">
            <h1>Adicionar Novo Produto</h1>
            <p>Preencha os detalhes para adicionar um novo produto ao seu inventário.</p>
        </div>

        <form id="uploadProductForm" enctype="multipart/form-data">
            <div class="form-grid">
                <div class="form-group full-width">
                    <label for="nome" class="form-label">Nome do Produto</label>
                    <input type="text" id="nome" name="nome" class="form-control"
                        placeholder="Ex: Poltrona Costela com Puff" required>
                </div>

                <div class="form-group full-width">
                    <label for="slug" class="form-label">Slug (URL amigável)</label>
                    <input type="text" id="slug" name="slug" class="form-control"
                        placeholder="Ex: poltrona-costela-com-puff-couro-preto" required>
                </div>

                <div class="form-group">
                    <label for="preco" class="form-label">Preço (R$)</label>
                    <input type="number" id="preco" name="preco" class="form-control" step="0.01"
                        placeholder="Ex: 1299.99" required>
                </div>

                <div class="form-group">
                    <label for="categoria" class="form-label">Categoria</label>
                    <input type="text" id="categoria" name="categoria" class="form-control"
                        placeholder="Ex: Móveis, Decoração">
                </div>

                <div class="form-group">
                    <label for="colecao" class="form-label">Coleção</label>
                    <input type="text" id="colecao" name="colecao" class="form-control"
                        placeholder="Ex: Coleção Viena 2024">
                </div>

                <div class="form-group">
                    <label for="ambientes" class="form-label">Ambientes (separados por vírgula)</label>
                    <input type="text" id="ambientes" name="ambientes" class="form-control"
                        placeholder="Ex: Sala de Estar, Quarto, Escritório">
                </div>

                <div class="form-group">
                    <label for="garantia" class="form-label">Garantia</label>
                    <input type="text" id="garantia" name="garantia" class="form-control" placeholder="Ex: 12 meses">
                </div>

                <div class="form-group">
                    <label for="imagens" class="form-label">Imagens (até 5)</label>
                    <input type="file" id="imagens" name="imagens" class="form-control" accept="image/*" multiple>


                    <div id="preview" style="display:flex; gap:0.5rem; margin-top:0.5rem; flex-wrap:wrap;">
                    </div>
                    


                </div>

                <div class="form-group full-width">
                    <label for="descricao" class="form-label">Descrição</label>
                    <textarea id="descricao" name="descricao" class="form-control" rows="5"
                        placeholder="Descreva o produto em detalhes..." required></textarea>
                </div>

                <div class="dimensions-group">
                    <div class="form-group">
                        <label for="altura" class="form-label">Altura (cm)</label>
                        <input type="number" id="altura" name="altura" class="form-control" step="0.01"
                            placeholder="Ex: 80.5">
                    </div>
                    <div class="form-group">
                        <label for="largura" class="form-label">Largura (cm)</label>
                        <input type="number" id="largura" name="largura" class="form-control" step="0.01"
                            placeholder="Ex: 120">
                    </div>
                    <div class="form-group">
                        <label for="profundidade" class="form-label">Profundidade (cm)</label>
                        <input type="number" id="profundidade" name="profundidade" class="form-control" step="0.01"
                            placeholder="Ex: 70">
                    </div>
                    <div class="form-group">
                        <label for="peso" class="form-label">Peso (kg)</label>
                        <input type="number" id="peso" name="peso" class="form-control" step="0.01"
                            placeholder="Ex: 15.2">
                    </div>
                </div>

                <div class="form-group">
                    <label for="estoque" class="form-label">Estoque</label>
                    <input type="number" id="stock" name="estoque" class="form-control" min="0" placeholder="Ex: 100">
                </div>

                <br>

                <div class="form-group form-check">
                    <input type="checkbox" class="form-check-input" id="ativo" name="ativo" value="true">
                    <label class="form-check-label" for="ativo">Produto Ativo</label>
                </div>

                <div class="form-group form-check">
                    <input type="checkbox" class="form-check-input" id="requerMontagem" name="requerMontagem">
                    <label class="form-check-label" for="requerMontagem">Requer Montagem</label>
                </div>

                <div class="form-group full-width">
                    <button type="submit" id="uploadProduct" class="btn btn-destaque">Adicionar Produto</button>
                </div>
            </div>
        </form>
    </div>
</div>



<script>
 
    document.getElementById('imagens')?.addEventListener('change', function(e) {
        const preview = document.getElementById('preview');
        preview.innerHTML = '';
        Array.from(this.files).slice(0,5).forEach(file => {
            const url = URL.createObjectURL(file);
            const img = document.createElement('img');
            img.src = url;
            img.style.width = '80px';
            img.style.height = '80px';
            img.style.objectFit = 'cover';
            img.style.borderRadius = '6px';
            preview.appendChild(img);
        });
    });
 
</script>

<script>
    document
        .getElementById("uploadProductForm")
        .addEventListener("submit", async function (event) {
            event.preventDefault();

            const notification = document.getElementById('notification-home');
            const loginButton = document.getElementById("uploadProduct");
            const originalButonText = loginButton.textContent;

            function showNotification(message, isSuccess) {
                notification.textContent = message;
                notification.style.backgroundColor = isSuccess ? '#dc3545' : '#28a745';
                notification.style.display = 'block';
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }

            loginButton.textContent = "Sending...";
            loginButton.disable = true;

            const formData = new FormData(this);
                
            const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

            try {
                const response = await fetch("/products", {
                    method: "POST",
                    headers: {
                        'X-CSRF-Token': csrfToken
                    },
                    body: formData,

                });

                const result = await response.json();
                showNotification(result.mensagem, result.success);

                if (response.ok) {
                    window.location.href = "/admin/inventory";
                } else {
                    showNotification(result.mensagem, result.success);
                }
                
            } catch (error) {
                console.error("Error:", error);
                showNotification("An error occurred while uploading the product.", false);
            }
            setTimeout(() => {
                loginButton.textContent = originalButonText;
                loginButton.disabled = false;
            }, 6000);


        });
</script>