<div class="container auth-container">
    <div class="card">
        <header style="text-align: center; margin-bottom: 1rem;">
            <h2>Esqueceu sua senha?</h2>
            <p style="font-weight: extra-bold;">Não se preocupe! Insira seus dados para recuperar o acesso.</p>
        </header>

        <% if (typeof mensagem !=='undefined' && mensagem) { %>
            <div
                style="background-color: #e7f3fe; border-left: 6px solid #2196F3; color: #333; padding: 1rem; margin-bottom: 1.5rem;">
                <p style="margin: 0;">
                    <%= mensagem %>
                </p>
            </div>
            <% } %>

                <% if (typeof error !=='undefined' && error) { %>
                    <div
                        style="background-color: #ffdddd; border-left: 6px solid #f44336; color: #333; padding: 1rem; margin-bottom: 1.5rem;">
                        <p style="margin: 0;">
                            <%= error %>
                        </p>
                    </div>
                    <% } %>

                        <form action="/auth/forgot-password" method="POST" id="forgotPasswod"
                            class="change-password-form">
                            <div class="form-group">
                                <label for="contact" class="form-label">E-mail ou Telefone</label>
                                <input type="text" id="contact" name="contact" class="form-control" required
                                    placeholder="Digite seu e-mail ou telefone">
                            </div>

                            <div class="form-group">
                                <p class="form-label">Enviar código de verificação via:</p>
                                <div class="radio-group" style="display: flex; gap: 1rem;">
                                    <label for="send-via-email" class="radio-label"
                                        style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="radio" id="send-via-email" name="send_method" value="email"
                                            checked>
                                        E-mail
                                    </label>
                                    <label for="send-via-sms" class="radio-label"
                                        style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="radio" id="send-via-sms" name="send_method" value="sms">
                                        SMS
                                    </label>
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 2rem;">
                                <button type="submit" class="btn btn-destaque" id="verifUser"
                                    style="width: 100%;">Enviar</button>
                            </div>
                        </form>

                        <div style="text-align: center; margin-top: 2rem;">
                            <p style="margin: 0;">Lembrou da senha? <a href="/login">Faça login</a>.</p>
                        </div>
    </div>
</div>

<script>

    document.getElementById("forgotPasswod").addEventListener("submit", async function (event) {

        event.preventDefault();

        const notification = document.getElementById('notification-home');
        const loginButton = document.getElementById("verifUser");
        const originalButonText = loginButton.textContent;


        function showNotification(message, isSuccess) {
            notification.textContent = message;
            notification.style.backgroundColor = isSuccess ? '#28a745' : '#dc3545';
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }


        loginButton.textContent = "Sending...";
        loginButton.disable = true;

        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());


        const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

        try {
            const response = await fetch("/auth/forgot-password", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    'X-CSRF-Token': csrfToken
                },
                body: JSON.stringify(data),
            });

            const result = await response.json();
            showNotification(result.message, result.success);

            if (response.ok) {
                console.log(data,result)
            } else {
                showNotification(result.message, result.success);
            }
        } catch (error) {

            console.error("Error:", error);
            loginButton.textContent = originalButonText;
            loginButton.disabled = false;
        }

    });

</script>